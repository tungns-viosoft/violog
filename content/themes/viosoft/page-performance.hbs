{{!< default}}

{{!-- This is a page template. A page outputs content just like any other post, and has all the same
    attributes by default, but you can also customise it to behave differently if you prefer. --}}

    {{!-- Everything inside the #post tags pulls data from the page --}}
    {{#post}}


<script type="text/javascript" src="{{asset "js/Chart.js"}}"></script> 
<script type="text/javascript" src="{{asset "js/pechart.js"}}"></script> 



<header class="main-header post-head {{#if image}}" style="background-image: url({{image}}){{else}}no-cover{{/if}}">
    <nav class="main-nav {{#if image}}overlay{{/if}} clearfix">
        {{#if @blog.logo}}<a class="blog-logo" href="{{@blog.url}}"><img src="{{@blog.logo}}" alt="{{@blog.title}}" /></a>{{/if}}
        {{#if @blog.navigation}}
        <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        {{/if}}
    </nav>
</header>

<main class="content" role="main" >

    <div class="container">

        <script type="text/javascript">
            var database;
            var usecases = [];
            var vnfs= [];
            var testcases = {};

            $.get(
                "http://localhost:1337/api/performance", function(data, status) {
                database = data;
                console.log(database);

                $.each(database, function(i, val){
                    if(!usecases.includes(val.usecase)){
                        usecases.push(val.usecase);
                    }
                });
                refreshUsecase();
            });

            function refreshUsecase(){
                refreshSelector("#usecase-selector", usecases);
            }

            function refreshVnf(){ 
                refreshSelector("#vnf-selector", vnfs);
            }

            function refreshTestcase(){ 
                refreshSelector("#testcase-selector", testcases);
            }


            function refreshSelector(id, arr ){
                var sl = $(id);
                sl.empty();
                $.each(arr, function(i,val){
                    var opt = '<option  value=' + i + ' >' +  val + '</option>';
                    sl.append(opt);
                });
            }

        </script>


        <div class="row"> 
            <div class="col-md-4">
                <div class="usecase-block block">
                    <div class="block-label">
                        <span id="usecase-label">Use case</span>
                    </div>

                    <div class="usecase-list">
                        <select id="usecase-selector" size="10">
                        <!-- Option data here -->
                        </select>
                    </div>

                </div>
            </div>

            <div class="col-md-4">
                <div class="vnf-block block">
                    <div class="block-label">
                        <span id="vnf-label">VNF</span>                    
                    </div>

                    <div class="vnf-list">
                        <select id="vnf-selector" name="vnf-selector" size="10">
                        </select>
                    </div>

                </div>

            </div>



            <div class="col-md-4">
                <div class="testcase-block block">
                    <div class="block-label">
                        <span id="testcase-label">Test case</span>                    
                    </div>

                    <div class="testcase-list">
                        <select id="testcase-selector" name="testcase-selector" size="10">
                        <!-- test case data here -->
                        </select>
                    </div>

                </div>  
            </div>

        </div>

        <div class="row">

            <div class="col-md-8">
                <div class="chart">                    
                    <canvas id="canvas"></canvas>
                </div>
            </div>

            <div class="col-md-4">
                <div class="testcase-table">
                    <table id="testcase-table">
                        <tr>
                            <th id="header-testcase">Test case</th>
                            <th id="header-action">Action</th>
                        </tr>
                        <tr>
                            <td>xxx</td>
                            <td>yyy</td>
                        </tr>


                    </table>
                </div>
            </div>  

        </div>


        <script type="text/javascript">

            var currentUsecase;
            var currentVnf;
            // var currentTestcase;

            var charttable = {};


            $("#usecase-selector").change(function(){
                currentUsecase = "";
                $( "select#usecase-selector option:selected" ).each(function() {
                  currentUsecase = $( this ).text();
                  return true;
                });

                //clear vnfs array
                while(vnfs.length > 0) {
                    vnfs.pop();
                }

                testcases = {};


                $.each(database, function(i,val){
                    if(val.usecase === currentUsecase && !vnfs.includes(val.vnfname) ){           
                        vnfs.push(val.vnfname);
                    }
                });
                refreshVnf();
                refreshTestcase();

            });

            $("#vnf-selector").change(function(){
                currentVnf = "";
                $( "select#vnf-selector option:selected" ).each(function() {
                  currentVnf = $( this ).text();
                  return true;
                });

                testcases = {};

                $.each(database, function(i,val){
                    if(val.usecase === currentUsecase && val.vnfname === currentVnf  ){           
                        // testcases.push(val.testcase);
                        testcases[i] = val.testcase;
                    }
                });
                refreshTestcase();

            });


            $("#testcase-selector").change(function(){
                var currentTestcase;
                var curKey;
                $( "select#testcase-selector option:selected" ).each(function() {
                  currentTestcase = $( this ).text();
                  curKey = $(this).val();
                  return true;
                });


                var row = {'key': curKey, 'testcase': currentTestcase};
                addCharttableRow(row);

            });

            var count = 0;



            function addCharttableRow(row){
                if(!charttable.hasOwnProperty(row.key)){


                    charttable[row.key] = row.testcase;

                    var tablerow = '<tr value=' + row.key +' ><td>' + row.testcase +'</td><td><button class="action-button" value="remove">Remove</button></td></tr>';


                    $(tablerow).hide().appendTo("table#testcase-table > tbody:last").fadeIn(300);                
                    // same way
                    // var x = $(row).hide().fadeIn(10000);
                    // $("table#testcase-table > tbody:last").append(x);

                    // console.log(database[row.key]);
                    if(count === 0){
                        loadChart(database[row.key], 'canvas');
                    } else{
                        addChart(database[row.key]);
                        reloadChart();
                    }

                    count++;

                } else {
                    console.log("key: " + row.key + " already exist");
                }


            }



            $('table#testcase-table').on('click', 'button.action-button',function(){
                var id = parseInt($(this).closest('tr').attr('value'));
                // console.log("remove id: " + id);
                // console.log($(this).closest('tr'));

                id = database[id].id;
                removeChart(id);
                reloadChart();

                $(this).closest('tr').remove();
            });




        </script>





    </div>

<!-- 
    <article class="{{post_class}}">


        <header class="post-header">
            <h1 class="post-title">{{title}}</h1>
        </header>

        <section class="post-content">
            {{content}}
        </section>

    </article>

-->

</main>





{{/post}}
